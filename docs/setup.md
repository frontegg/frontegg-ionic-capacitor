# Project setup

This section guides you through configuring the Frontegg SDK for Ionic Capacitor apps, including setup for both iOS and Android platforms.

## Setup iOS project

### Create Frontegg.plist

To setup your SwiftUI application to communicate with Frontegg.

1. Open the iOS project generated by Capacitor using the following command, or open it manually in Xcode:

   ```bash
      ionic capacitor open ios
   ```
2. In the root of your iOS project, create a new file named `Frontegg.plist` and add the following content:

    ```xml
    <?xml version="1.0" encoding="UTF-8"?>
    <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
    <plist version="1.0">
    <dict>
        <key>lateInit</key>
        <true/>
    </dict>
    </plist>
    ```

   This file provides configuration values used by the Frontegg SDK.

3. In the `/ios/App` directory, make sure `CODE_SIGNING_ALLOWED` is enabled in the `Podfile`.

### Handle open app with URL for iOS

To support login via magic link and other authentication methods that require your app to handle incoming URLs, add the following code to your `AppDelegate.swift` file.

```swift
import UIKit
import Capacitor
import FronteggSwift

@UIApplicationMain
class AppDelegate: UIResponder, UIApplicationDelegate {

    /*
     * Called when the app was launched with a url. Feel free to add additional processing here,
     * but if you want the App API to support tracking app url opens, make sure to keep this call
     */
    func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {
        
        if(FronteggAuth.shared.handleOpenUrl(url)){
            return true
        }
        
        return ApplicationDelegateProxy.shared.application(app, open: url, options: options)
    }
    
    /*
     * Called when the app was launched with an activity, including Universal Links.
     * Feel free to add additional processing here, but if you want the App API to support
     * tracking app url opens, make sure to keep this call
     */
    func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {
        
        if let url = userActivity.webpageURL {
            if(FronteggAuth.shared.handleOpenUrl(url)){
                return true
            }
        }
        return ApplicationDelegateProxy.shared.application(application, continue: userActivity, restorationHandler: restorationHandler)
    }
}
```

### Configure iOS associated domain

To enable domain-based authentication flows, like magic link, password reset and user activation, follow the steps below to register your application's domain:

1. Generate an environment token as desxcribed in [this guide](https://docs.frontegg.com/reference/getting-started-with-your-api).

2. Send a `POST` request to the following endpoint: `POST https://api.frontegg.com/vendors/resources/associated-domains/v1/ios`. Example payload:

```json
{
  "appId": "{{ASSOCIATED_DOMAIN}}"
}
```

Replace `{{ASSOCIATED_DOMAIN}}` with the domain you want to use (e.g., `example.com`).


## Setup Android project

### Set the minimum SDK version

1. Open your project in Android Studio.
2. Navigate to the root-level Gradle file: `android/build.gradle`.
3. Locate the `buildscript.ext` section in the file.
4. Add or update the `minSdkVersion` value. For example:

```groovy
buildscript {
    ext {
        minSdkVersion = 26
        // ...
    }
}
```

### Configure build config fields

To set up your Android application on to communicate with Frontegg:

1. Add `buildConfigField` entries to `android/app/build.gradle`: 

```groovy
def fronteggDomain = "{{FRONTEGG_BASE_URL}}" // without protocol https://
def fronteggClientId = "{{CLIENT_ID}}"

android {
    defaultConfig {

        manifestPlaceholders = [
                "package_name" : "{{ANDROID_PACKAGE_NAME}}",
                "frontegg_domain" : fronteggDomain,
                "frontegg_client_id": fronteggClientId
        ]
    }
    
    
}
```

- Replace `{{FRONTEGG_BASE_URL}}` with the domain name from your Frontegg Portal.
- Replace `{{FRONTEGG_CLIENT_ID}}` with your Frontegg client ID.

2. Add `buildConfig = true` under the `buildFeatures` block in the `android` section of your `android/app/build.gradle` file if it doesn't already exist:

```groovy
android {
  buildFeatures {
    buildConfig = true
  }
}
```

### Enable Android AssetLinks

Configure Android AssetLinks for צagic ךink authentication, password resets, login with passkeys, and IdP SSO login.

1. Get your SHA-256 certificate fingerprint:
```bash
# For debug builds
./gradlew signingReport

# For release builds
keytool -list -v -keystore /PATH/file.jks -alias YourAlias -storepass *** -keypass ***
```

2. Obtain an environment token by following [these instructions](https://developers.frontegg.com/api/vendor-service)

Send a POST request to Frontegg API:

https://api.frontegg.com/vendors/resources/associated-domains/v1/android

```
{
    "packageName": "{{ANDROID_PACKAGE_NAME}}",
    "sha256CertFingerprints": ["{{KEYSTORE_CERT_FINGERPRINTS}}"]
}
```

To review the Asset Links configuration, you may send a `GET` request to the same endpoint:

```
https://api.frontegg.com/vendors/resources/associated-domains/v1/android
```

To update the configuration, first `DELETE` the existing configuration using its configuration ID, then create a new configuration via `POST`. For example:

```
https://api.frontegg.com/vendors/resources/associated-domains/v1/android/{{configurationId}} 

```


3. Get your `sha256CertFingerprints`. Each Android app has multiple certificate fingerprints. You must extract at least the one for `DEBUG` and optionally for `RELEASE`.

**For Debug mode**:
   
1. Open a terminal in your project root.
2. Run the following command:

```
./gradlew signingReport
```
3. Look for the section with:

```
Variant: debug
Config: debug
```
4. Copy the SHA-256 value from the output. Make sure the `Variant` and `Config` both equal `debug`.

Example output:

```
./gradlew signingReport

###################
#  Example Output:
###################

#  Variant: debug
#  Config: debug
#  Store: /Users/davidfrontegg/.android/debug.keystore
#  Alias: AndroidDebugKey
#  MD5: 25:F5:99:23:FC:12:CA:10:8C:43:F4:02:7D:AD:DC:B6
#  SHA1: FC:3C:88:D6:BF:4E:62:2E:F0:24:1D:DB:D7:15:36:D6:3E:14:84:50
#  SHA-256: D9:6B:4A:FD:62:45:81:65:98:4D:5C:8C:A0:68:7B:7B:A5:31:BD:2B:9B:48:D9:CF:20:AE:56:FD:90:C1:C5:EE
#  Valid until: Tuesday, 18 June 2052
```

**For Release mode**:

1. Run the following command (customize the path and credentials):

```bash
keytool -list -v -keystore /PATH/file.jks -alias YourAlias -storepass *** -keypass ***
```

2. Copy the `SHA-256` value from the output.
